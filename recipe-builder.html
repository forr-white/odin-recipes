<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Recipe Builder</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="builder-header">
    <a href="index.html"><img src="images/logo.svg" alt="Logo"></a>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="recipe-builder.html">Recipe Builder</a>
      <a href="license.html">License</a>
    </div>
    <h1 class="recipe-builder">Recipe Builder</h1>
  </header>

  <section id="builder" class="cta">
    <div class="cta-left">
      <h3>Create a New Recipe</h3>
      <nav><a href="index.html">Home</a></nav>
      <p>Fill out the form below to generate a custom recipe page and save it to your sheet.</p>
      <p>Recipes will show up at the bottom of the homescreen but will not be available until pages have been committed.</p>
    </div>

    <div class="cta-right">
      <label for="new-name">Recipe Name</label>
      <input type="text" id="new-name">

      <label for="new-image">Image URL (optional)</label>
      <input type="text" id="new-image" placeholder="https://example.com/recipe.jpg">

      <label for="new-category">Category</label>
      <select id="new-category">
        <option value="">Select a Category</option>
        <option value="appetizers">Appetizers</option>
        <option value="bread">Bread</option>
        <option value="breakfast">Breakfast</option>
        <option value="desserts">Desserts</option>
        <option value="dinner">Dinner</option>
        <option value="drinks">Drinks</option>
        <option value="lunch">Lunch</option>
        <option value="salads">Salads</option>
        <option value="sauce">Sauce</option>
        <option value="sides">Sides</option>
        <option value="snacks">Snacks</option>
        <option value="soups">Soups</option>
      </select>

      <label for="new-cuisine">Cuisine</label>
      <input type="text" id="new-cuisine" placeholder="e.g. Italian, Mexican, American">

      <label for="new-tags">Tags (comma separated)</label>
      <input type="text" id="new-tags" placeholder="e.g. easy, gluten-free, family">

      <label for="new-ingredients">Ingredients (one per line)</label>
      <textarea id="new-ingredients"></textarea>

      <label for="new-directions">Directions (one step per line)</label>
      <textarea id="new-directions"></textarea>

      <label for="new-notes">Notes (optional, one per line)</label>
      <textarea id="new-notes"></textarea>

      <div class="nutrition-inputs">
  <h3>Nutrition (optional)</h3>
  <label>Serving Size</label>
  <input type="text" id="nutrition-serving-size" placeholder="e.g. 1 serving">

  <label>Calories</label>
  <input type="text" id="nutrition-calories" placeholder="e.g. 230">
  
  <label>Fat (g)</label>
  <input type="text" id="nutrition-fat" placeholder="e.g. 8">
  
  <label>Carbs (g)</label>
  <input type="text" id="nutrition-carbs" placeholder="e.g. 27">
  
  <label>Protein (g)</label>
  <input type="text" id="nutrition-protein" placeholder="e.g. 5">
</div>


      <button id="generate-btn">Generate & Save Recipe</button>
    </div>
  </section>

  <script>
const generateBtn = document.getElementById("generate-btn");

generateBtn.addEventListener("click", async () => {
  const name = document.getElementById("new-name").value.trim();
  const image = document.getElementById("new-image").value.trim();
  const category = document.getElementById("new-category").value;
  const cuisine = document.getElementById("new-cuisine").value.trim();
  const tagsArray = document.getElementById("new-tags").value.split(",").map(t => t.trim()).filter(Boolean);
  const tags = tagsArray.join(", ");
  const ingredients = document.getElementById("new-ingredients").value.split("\n").map(i => i.trim()).filter(Boolean);
  const directions = document.getElementById("new-directions").value.split("\n").map(d => d.trim()).filter(Boolean);
  const notes = document.getElementById("new-notes").value.split("\n").map(n => n.trim()).filter(Boolean);
  const nutrition = {
  servingSize: document.getElementById("nutrition-serving-size").value,
  calories: document.getElementById("nutrition-calories").value,
  fat: document.getElementById("nutrition-fat").value,
  carbs: document.getElementById("nutrition-carbs").value,
  protein: document.getElementById("nutrition-protein").value
};

  if (!name || !category || ingredients.length === 0 || directions.length === 0) {
    alert("Please fill in at least the name, category, ingredients, and directions.");
    return;
  }

  const filename = `${name.replace(/\s+/g, "-").toLowerCase()}.html`;
  const link = `recipes/${filename}`;

  const form = new FormData();
  form.append('name', name);
  form.append('category', category);
  form.append('link', link);
  form.append('cuisine', cuisine);
  form.append('tags', tags);
  form.append('image', image);
  form.append('ingredients', JSON.stringify(ingredients));
  form.append('directions', JSON.stringify(directions));
  form.append('notes', JSON.stringify(notes));

  try {
    const resp = await fetch("https://script.google.com/macros/s/AKfycbxnZGlirHNibP1tXTYL4oN1G7_FliKrjfmnDZrrIQ4WA4JCwS6BBqJwA4Ee_Hu3gbpf-Q/exec", {
      method: "POST",
      body: form
    });

    const result = await resp.json();
    if (result.status === "success") {
      alert("Recipe saved to Google Sheet successfully!");
    } else {
      alert("Error saving recipe: " + (result.message || "unknown"));
    }

  } catch (err) {
    alert("Network or server error: " + err.message);
    console.error(err);
  }

const htmlContent = `<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>${name}</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="recipe.css">
</head>
<body>

<header class="recipe-header">
  <a href="../index.html">
    <img src="../images/logo.svg" alt="Cook Anything Kitchen Logo">
  </a>
</header>

<main class="recipe-container">
  <h1 class="recipe-title">${escapeHtml(name)}</h1>
  <div class="recipe-meta">${escapeHtml(category)}${cuisine ? " â€¢ " + escapeHtml(cuisine) : ""}</div>

  ${image ? `<img src="${escapeHtml(image)}" alt="${escapeHtml(name)}" class="recipe-image">` : ""}

  <section class="recipe-section">
    <h2>Ingredients</h2>
    <ul>${ingredients.map(i => `<li>${escapeHtml(i)}</li>`).join("")}</ul>
  </section>

  <section class="recipe-section">
    <h2>Directions</h2>
    <ol>${directions.map(d => `<li>${escapeHtml(d)}</li>`).join("")}</ol>
  </section>

  ${notes.length ? `
  <section class="recipe-section notes">
    <h2>Notes</h2>
    <ol>${notes.map(n => `<li>${escapeHtml(n)}</li>`).join("")}</ol>
  </section>` : ""}

  ${(nutrition.servingSize || nutrition.calories || nutrition.fat || nutrition.carbs || nutrition.protein) ? `
<section class="recipe-section nutrition">
  <h2>Nutritional Information</h2>
  <div class="nutrition-card">
    ${nutrition.servingSize ? `<p><strong>Serving Size:</strong> ${nutrition.servingSize}</p>` : ""}
    ${nutrition.calories ? `<p><strong>Calories:</strong> ${nutrition.calories}</p>` : ""}
    ${nutrition.fat ? `<p><strong>Fat:</strong> ${nutrition.fat} g</p>` : ""}
    ${nutrition.carbs ? `<p><strong>Carbohydrates:</strong> ${nutrition.carbs} g</p>` : ""}
    ${nutrition.protein ? `<p><strong>Protein:</strong> ${nutrition.protein} g</p>` : ""}
  </div>
</section>` : ""}

</main>
<footer class="footer">
  <div class="footer-content">
    <div class="footer-logo">
      <img src="../images/logo.svg" alt="Site Logo">
      <span>Cook Anything Kitchen</span>
    </div>
    <div class="footer-nav">
      <a href="../index.html">Home</a>
      <a href="../recipe-builder.html">Recipe Builder</a>
      <a href="../license.html">License</a>
    </div>
    <p class="footer-copy">&copy; 2025 Cook Anything Kitchen. All rights reserved.</p>
  </div>
</footer>
</body>
</html>`;



  const blob = new Blob([htmlContent], { type: "text/html" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);

  document.querySelectorAll("#new-name,#new-image,#new-category,#new-cuisine,#new-tags,#new-ingredients,#new-directions,#new-notes").forEach(el => el.value = "");
});

function escapeHtml(str) {
  return String(str)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}
</script>

<footer class="footer">
  <div class="footer-content">
    <div class="footer-logo">
      <a href="index.html"><img src="https://cookanythingkitchen.com/images/logo.svg" alt="Site Logo"></a>
    </div>
    <div class="footer-nav">
      <a href="index.html">Home</a>
      <a href="recipe-builder.html">Recipe Builder</a>
      <a href="license.html">License</a>
    </div>
    <p class="footer-copy">&copy; 2025 Cook Anything Kitchen. All rights reserved.</p>
  </div>
</footer>

<script src="config-check.js" defer></script>

</body>
</html>
