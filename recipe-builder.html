<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Recipe Builder</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Recipe Builder -->
  <section id="builder" class="cta">
  <div class="cta-left">
    <h3>Create a New Recipe</h3>
    <p>Fill out the form below to generate a custom recipe page you can download and save.</p>
  </div>
<div class="cta-right">
      <label for="new-name">Recipe Name</label>
      <input type="text" id="new-name">

      <label for="new-image">Image URL (optional)</label>
      <input type="text" id="new-image" placeholder="https://example.com/recipe.jpg">

      <label for="new-category">Category</label>
      <select id="new-category">
        <option value="">Select a Category</option>
        <option value="appetizers">Appetizers</option>
        <option value="bread">Bread</option>
        <option value="breakfast">Breakfast</option>
        <option value="desserts">Desserts</option>
        <option value="dinner">Dinner</option>
        <option value="drinks">Drinks</option>
        <option value="lunch">Lunch</option>
        <option value="salads">Salads</option>
        <option value="sauce">Sauce</option>
        <option value="sides">Sides</option>
        <option value="snacks">Snacks</option>
        <option value="soups">Soups</option>
      </select>

      <label for="new-ingredients">Ingredients (one per line)</label>
      <textarea id="new-ingredients"></textarea>

      <label for="new-directions">Directions (one step per line)</label>
      <textarea id="new-directions"></textarea>

      <label for="new-notes">Notes (optional, one per line)</label>
      <textarea id="new-notes"></textarea>

      <button id="generate-btn">Generate Recipe File</button>
    </div>
  </section>
    <script>
  const generateBtn = document.getElementById("generate-btn");

generateBtn.addEventListener("click", async () => {
  const name = document.getElementById("new-name").value.trim();
  const image = document.getElementById("new-image").value.trim();
  const category = document.getElementById("new-category").value;
  const ingredients = document.getElementById("new-ingredients").value
                        .split("\n").map(i => i.trim()).filter(i => i);
  const directions = document.getElementById("new-directions").value
                        .split("\n").map(d => d.trim()).filter(d => d);
  const notes = document.getElementById("new-notes").value
                        .split("\n").map(n => n.trim()).filter(n => n);

  if (!name || !category || !ingredients.length || !directions.length) {
    alert("Please fill in at least name, category, ingredients, and directions.");
    return;
  }

  const recipeData = {
    name,
    category,
    image,
    ingredients,
    directions,
    notes
  };

  // 1️⃣ POST to Google Sheet
  try {
    const response = await fetch("https://script.google.com/macros/s/AKfycbz13XDkevxqBEYk5yh3VNXyHDsl8R9G7Ilc66aldu6NyAD67PxOwcnRIJVmxpHqATzurw/exec", {
      method: "POST",
      body: JSON.stringify(recipeData),
      headers: { "Content-Type": "application/json" }
    });
    const result = await response.json();
    if (result.status === "success") {
      alert("Recipe successfully saved to Google Sheet!");
    } else {
      alert("Error saving recipe: " + result.message);
    }
  } catch (err) {
    alert("Network or server error: " + err.message);
  }

  // 2️⃣ Generate HTML file
  const htmlContent = `
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>${name}</title>
<style>
body { font-family: Arial, sans-serif; background: #f8fafc; margin: 0; padding: 20px; }
.container { max-width: 980px; margin: 0 auto; }
header { margin-bottom: 16px; }
h1 { margin-bottom: 12px; }
nav a { margin-right: 12px; text-decoration: none; color: #0369a1; }
img { max-width: 60%; height: auto; margin-bottom: 20px; border-radius: 8px; }
ul, ol { padding-left: 20px; }
li { margin-bottom: 6px; }
a { color: #0369a1; text-decoration: none; }
</style>
</head>
<body>
<div class="container">
<header>
<h1>${name}</h1>
<h4>${category}</h4>
<nav>
<a href="../index.html">Home</a>
</nav>
</header>
${image ? `<img src="${image}" alt="${name}">` : ""}
<h2>Ingredients</h2>
<ul>
${ingredients.map(i => `<li>${i}</li>`).join("\n")}
</ul>
<h2>Directions</h2>
<ol>
${directions.map(d => `<li>${d}</li>`).join("\n")}
</ol>
${notes.length ? `<h2>Notes</h2>
<ol>
${notes.map(n => `<li>${n}</li>`).join("\n")}
</ol>` : ""}
</div>
</body>
</html>
  `;

  // Trigger download
  const blob = new Blob([htmlContent], { type: "text/html" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.href = url;
  link.download = `${name.replace(/\s+/g, "-").toLowerCase()}.html`;
  link.click();
  URL.revokeObjectURL(url);

  // Optional: clear form
  document.getElementById("new-name").value = "";
  document.getElementById("new-image").value = "";
  document.getElementById("new-category").value = "";
  document.getElementById("new-ingredients").value = "";
  document.getElementById("new-directions").value = "";
  document.getElementById("new-notes").value = "";
});
</script>
  </body>
  </html>