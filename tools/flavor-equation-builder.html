<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flavor Equation Builder | Cook Anything Kitchen</title>
  <link rel="icon" href="../images/logo.svg" type="image/svg+xml" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
  <header class="header">
    <div class="logo">
      <a href="../index.html"><img src="../images/logo.svg" alt="Cook Anything Kitchen logo" /></a>
    </div>
    <nav class="header-nav">
      <a href="../index.html">Home</a>
      <a href="https://www.skool.com/cook-anything-kitchen-9636/about?ref=a42cb417403c47368cddd32ba708fd26">Learn To Cook!</a>

      <div class="dropdown">
        <button class="dropbtn">Tools â–¾</button>
        <div class="dropdown-content">
          <a href="../recipe-builder.html">Recipe Builder</a>
          <a href="../tools/flavor-compass.html">Flavor Compass</a>
          <a href="../tools/controlled-chaos-tracker.html">Controlled Chaos Tracker</a>
          <a href="../tools/flavor-equation-builder.html">Flavor Equation Builder</a>
          <a href="../downloads/flavor-playbook.pdf" target="_blank">ðŸ“˜ Flavor Playbook (PDF)</a>
        </div>
      </div>

      <a href="../license.html">License</a>
    </nav>
  </header>

  <main>
    <section class="tool-card">
      <h1>Flavor Equation Builder</h1>
      <p class="subtitle">Design, measure, and balance your flavor systems.</p>

      <form id="flavorForm">
        <label>Dish Name</label>
        <input type="text" id="dish" placeholder="e.g., Lemon Herb Chicken" required />

        <label>Target Experience</label>
        <select id="target">
          <option>Bright</option><option>Bold</option><option>Comforting</option>
          <option>Fresh</option><option>Rich</option><option>Smoky</option><option>Balanced</option>
        </select>

        <label>Base Ingredient</label>
        <select id="base">
          <option>Protein</option><option>Vegetable</option>
          <option>Grain</option><option>Other</option>
        </select>

        <label>Cooking Method</label>
        <select id="method">
          <option>Sear</option><option>Roast</option><option>Boil</option>
          <option>Fry</option><option>Ferment</option><option>Mix</option><option>Bake</option>
        </select>

        <h2>Flavor Ratios (%)</h2>
        <div id="sliders"></div>

        <div class="buttons">
          <button type="button" id="saveBtn">Save Equation</button>
          <button type="button" id="exportBtn">Export TXT</button>
          <button type="button" id="clearBtn">Clear Form</button>
        </div>
      </form>
    </section>

    <section class="chart-container">
      <h2>Flavor Profile Visualization</h2>
      <canvas id="flavorChart" width="300" height="300"></canvas>
      <p><strong>Flavor Balance Score:</strong> <span id="balanceScore">0</span>/100</p>
      <p id="analysis" style="font-style: italic; color: var(--muted);"></p>
    </section>

    <section class="recent">
      <h2>Recent Equations</h2>
      <div id="recentEntries"></div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-logo">
        <img src="../images/logo.svg" alt="Cook Anything Kitchen logo" />
        Cook Anything Kitchen
      </div>
      <p class="footer-copy">Â© 2025 Cook Anything Kitchen â€” All Rights Reserved</p>
    </div>
  </footer>

  <script>
    const flavors = ['Salt','Fat','Acid','Sweet','Bitter','Umami','Texture'];
    const sliderContainer = document.getElementById('sliders');
    flavors.forEach(f => {
      const div = document.createElement('div');
      div.className = 'slider-group';
      div.innerHTML = `
        <label>${f} <output id="${f}Value">50</output></label>
        <input type="range" min="0" max="100" value="50" id="${f}">
      `;
      sliderContainer.appendChild(div);
      const slider = div.querySelector('input');
      const output = div.querySelector('output');
      slider.oninput = () => {
        output.textContent = slider.value;
        updateChart();
      };
    });

    const ctx = document.getElementById('flavorChart').getContext('2d');
    let chartColor = '#60a5fa';
    let flavorChart = new Chart(ctx, {
      type: 'radar',
      data: {
        labels: flavors,
        datasets: [{
          label: 'Flavor Equation',
          data: [50,50,50,50,50,50,50],
          backgroundColor: chartColor + '33',
          borderColor: chartColor,
          borderWidth: 2
        }]
      },
      options: {
        scales: { 
          r: {
            beginAtZero: true,
            max: 100,
            grid: { color: '#ddd' },
            angleLines: { color: '#eee' },
            pointLabels: { color: '#111' }
          }
        },
        plugins: { legend: { display: false } }
      }
    });

    const colors = {
      'Bright': '#facc15','Bold': '#f87171','Comforting': '#86efac',
      'Fresh': '#60a5fa','Rich': '#fb923c','Smoky': '#9ca3af','Balanced': '#6366f1'
    };

    function updateChart() {
      const values = flavors.map(f => parseInt(document.getElementById(f).value));
      const target = document.getElementById('target').value;
      chartColor = colors[target] || '#60a5fa';
      flavorChart.data.datasets[0].data = values;
      flavorChart.data.datasets[0].backgroundColor = chartColor + '33';
      flavorChart.data.datasets[0].borderColor = chartColor;
      flavorChart.update();
      updateScore(values);
    }

    document.getElementById('target').addEventListener('change', updateChart);

    function updateScore(values) {
      const avg = values.reduce((a,b)=>a+b,0)/values.length;
      const variance = values.reduce((a,b)=>a+Math.pow(b-avg,2),0)/values.length;
      const score = Math.max(0, Math.round(100 - variance/2));
      document.getElementById('balanceScore').textContent = score;
      updateAnalysis(values, score);
    }

    function updateAnalysis(values, score) {
      const maxFlavor = flavors[values.indexOf(Math.max(...values))];
      let message = "";
      if (score > 85) message = "Perfectly balanced â€” harmonious flavor profile.";
      else if (score > 70) message = "Mostly balanced â€” slightly " + maxFlavor.toLowerCase() + "-forward.";
      else if (score > 50) message = "Uneven â€” " + maxFlavor + " dominates the mix.";
      else message = "Highly unbalanced â€” experiment for control.";
      document.getElementById('analysis').textContent = message;
    }

    document.getElementById('saveBtn').addEventListener('click', () => {
      const entry = {
        dish: document.getElementById('dish').value,
        target: document.getElementById('target').value,
        base: document.getElementById('base').value,
        method: document.getElementById('method').value,
        values: flavors.map(f => parseInt(document.getElementById(f).value)),
        score: document.getElementById('balanceScore').textContent,
        analysis: document.getElementById('analysis').textContent,
        date: new Date().toLocaleDateString()
      };
      if (!entry.dish.trim()) { alert("Enter a dish name before saving."); return; }
      let entries = JSON.parse(localStorage.getItem('flavorEquations') || '[]');
      entries.unshift(entry);
      localStorage.setItem('flavorEquations', JSON.stringify(entries.slice(0,10)));
      updateRecent();
      alert("Flavor Equation saved!");
    });

    document.getElementById('exportBtn').addEventListener('click', () => {
      const dish = document.getElementById('dish').value || 'FlavorEquation';
      let text = `Flavor Equation Builder â€” ${dish}\n\n`;
      text += `Target Experience: ${document.getElementById('target').value}\n`;
      text += `Base: ${document.getElementById('base').value}\nMethod: ${document.getElementById('method').value}\n\n`;
      flavors.forEach(f => { text += `${f}: ${document.getElementById(f).value}%\n`; });
      text += `\nBalance Score: ${document.getElementById('balanceScore').textContent}\n`;
      text += `Analysis: ${document.getElementById('analysis').textContent}\n`;
      const blob = new Blob([text], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = dish.replace(/\s+/g, '_') + "_Equation.txt";
      a.click();
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      if (confirm("Clear all form fields?")) {
        document.getElementById('flavorForm').reset();
        flavors.forEach(f => document.getElementById(f+'Value').textContent = 50);
        updateChart();
      }
    });

    function updateRecent() {
      const container = document.getElementById('recentEntries');
      const entries = JSON.parse(localStorage.getItem('flavorEquations') || '[]');
      container.innerHTML = '';
      entries.slice(0,3).forEach(e => {
        const div = document.createElement('div');
        div.className = 'entry';
        div.innerHTML = `<strong>${e.dish}</strong> â€” ${e.date}<br>
        Target: ${e.target} | Score: ${e.score}`;
        container.appendChild(div);
      });
    }

    updateRecent();
    updateChart();
  </script>
</body>
</html>
